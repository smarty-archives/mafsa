package mafsa

import (
	"bytes"
	"testing"
)

func TestEncoder(t *testing.T) {
	tree := New()
	tree.Insert("dog")
	tree.Insert("dogs")
	tree.Insert("hello")
	tree.Insert("jello")
	err := tree.Insert("été")
	if err != nil {
		t.Errorf("Could not insert 'été': %q", err)
	}
	err = tree.Insert("あello")
	if err != nil {
		t.Errorf("Could not insert 'あello': %q", err)
	}
	tree.Finish()

	enc := new(Encoder)
	actual, err := enc.Encode(tree)
	if err != nil {
		t.Errorf("Encode produced an error: %v", err)
	}

	if !bytes.Equal(actual, encodedTestTree) {
		t.Errorf("\nExpected:\n%x\nGot:\n%v", encodedTestTree, actual)
	}
}

var encodedTestTree = []byte{
	0x02, 0x04, 0x00, 0x00, 0x00, 0x00, 0x04, 0x64,
	0x00, 0x00, 0x00, 0x27, 0x04, 0x68, 0x00, 0x00,
	0x00, 0x2d, 0x04, 0x6a, 0x00, 0x00, 0x00, 0x33,
	0x08, 0xc3, 0xa9, 0x00, 0x00, 0x00, 0x39, 0x0e,
	0xe3, 0x81, 0x82, 0x00, 0x00, 0x00, 0x3f, 0x06,
	0x6f, 0x00, 0x00, 0x00, 0x45, 0x06, 0x65, 0x00,
	0x00, 0x00, 0x4b, 0x06, 0x65, 0x00, 0x00, 0x00,
	0x4b, 0x06, 0x74, 0x00, 0x00, 0x00, 0x51, 0x06,
	0x65, 0x00, 0x00, 0x00, 0x4b, 0x07, 0x67, 0x00,
	0x00, 0x00, 0x58, 0x06, 0x6c, 0x00, 0x00, 0x00,
	0x5e, 0x0b, 0xc3, 0xa9, 0x00, 0x00, 0x00, 0x00,
	0x07, 0x73, 0x00, 0x00, 0x00, 0x00, 0x06, 0x6c,
	0x00, 0x00, 0x00, 0x64, 0x07, 0x6f, 0x00, 0x00,
	0x00, 0x00,
}
